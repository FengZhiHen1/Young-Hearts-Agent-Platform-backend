# “心青年”智能体平台 技术栈设计文档

## 文档日期

2025-12-27

## 关联功能文档

`docs/2025-12-27-“心青年”智能体平台-功能文档-落地版.md`

## 项目约束条件

- 开发团队以大一学生为主，技术水平有限（熟悉 MySQL、React、Taro、FastAPI/Flask）。
- 优先交付可落地的 MVP（第一阶段：知识库问答、内容管理后台、场景指南、工单）。
- 开发与部署环境以容器化（Docker）或简单本地部署为主；开发阶段可在 Windows 下进行。
- 注重合规与隐私最小化，敏感数据需加密与可删除接口。
- 性能目标：在常见查询场景下 20 秒内返回首条建议；检索规模初期较小（数百到数千条条目）。

## 技术栈概览

| 技术维度 | 选用技术 | 核心作用 |
|---|---|---|
| 前端框架 | `React` + `Vite` + `Ant Design` | 管理后台与用户端界面，组件化、开发效率高。 |
| 后端语言/框架 | `Python` + `FastAPI` | 轻量、高性能、与团队熟悉度高；良好类型支持与自动文档。 |
| 数据库（关系） | `MySQL`（或 `MariaDB`） | 存储结构化条目、用户与工单，团队已有经验。 |
| 全文检索（MVP） | `SQLite FTS` 或 MySQL Fulltext（开发阶段） | 简单可用、低运维成本；满足 MVP 索引需求。 |
| 向量检索（未来） | `Milvus` 或 `Weaviate`（第二阶段） | 支持 RAG 的向量检索与扩展性。 |
| 缓存/任务队列 | `Redis`（缓存、Celery broker） + `Celery` | 缓存热点数据、后台任务（媒体处理、邮件/通知）。 |
| 对象存储 | 本地 `uploads/`（开发）→ `S3` 或 `MinIO`（生产） | 存储图片/短视频，便于扩展与备份。 |
| 身份认证 | `JWT`（FastAPI + OAuth2 Password Flow） | 简单、跨前端使用；配合角色（admin/expert/reviewer）。 |
| 部署 | `Docker` + `docker-compose`（初期）→ Kubernetes（可选） | 快速搭建本地/云环境，易于 CI/CD。 |
| CI/CD | `GitHub Actions` | 自动化测试、镜像构建与发布。 |
| 监控与错误追踪 | `Sentry`（错误） + `Prometheus`/`Grafana`（指标） | 及时发现运行错误与性能瓶颈。 |
| 日志 | 结构化日志（JSON）到文件/外部服务 | 支持审计与问题排查。 |
| 模型/LLM | 第一期：外部 API（OpenAI 等）或基于模板的规则；第二期：向量检索 + 生成模型（OpenAI、Mistral 或本地 LLM） | RAG 实现与后续能力提升。 |

## 核心功能技术实现

### 功能模块1：知识库问答（FAQ & 基础检索）

| 技术点 | 选用技术 | 选型理由 |
|---|---|---|
| 数据模型 | `MySQL`（`knowledge_item` 表） | 团队熟悉，便于管理结构化字段（title, summary, steps_json, tags, age_range）。 |
| 基础检索 | `MySQL Fulltext` 或 `SQLite FTS` | 开发阶段零运维、实现简单；满足 MVP 性能要求。 |
| API 设计 | `FastAPI` 路由：`GET /api/v1/knowledge/search?q=`、`GET /api/v1/knowledge/{id}` | FastAPI 与 Pydantic 提供清晰的输入/输出模型与自动文档。 |
| 答案结构 | 返回 `summary` / `steps[]` / `source` / `confidence` | 方便前端渲染“快速处置卡”，并满足合规可追溯性。 |

### 功能模块2：专业内容管理后台

| 技术点 | 选用技术 | 选型理由 |
|---|---|---|
| 前端 | `React` + `Ant Design` + `Vite` | 企业级组件库（表单、表格、上传），开发效率高，文档齐全。 |
| 文件上传 | 本地 `uploads/`（dev）→ `S3/MinIO`（prod） | 简单可行，便于在未来切换到云存储。 |
| 角色与权限 | `FastAPI` + JWT + Role middleware | 支持 admin/expert/reviewer 的 CRUD 与审核流程。 |
| 版本管理 | `knowledge_item_version` 表或记录历史变更日志 | 简单实现版本回滚与审计。 |

### 功能模块3：常见场景指南

| 技术点 | 选用技术 | 选型理由 |
|---|---|---|
| 模板与导出 | 前端生成 PDF（`react-pdf` 或后端用 `weasyprint`） | 支持打印/下载的一页式处置卡。 |
| 数据模型 | `scene_guide` 表（steps、materials、注意事项） | 与知识库分表管理，便于按年龄与场景检索。 |

### 功能模块4：咨询工单/留言

| 技术点 | 选用技术 | 选型理由 |
|---|---|---|
| 工单存储 | `ticket` 表（priority、status、assigned_to） | 关系型存储便于指派、状态变更与历史记录。 |
| 通知 | 后台任务（Celery）发送邮件/后台通知 | 异步处理通知，避免阻塞主请求。 |
| 人工接入 | 管理后台工单视图 + 邮件告警 | 简单、可行的初期人工跟进流程。 |

## 辅助功能技术实现

- 媒体处理：使用后台任务（Celery + Redis）处理上传的视频缩略、转码（如果需要）。
- 安全与隐私：敏感字段加密（数据库层或应用层）、提供导出/删除接口、最小化采集用户数据。
- 备份策略：定期备份 MySQL 数据库与对象存储，开发阶段可使用简单脚本上传备份到安全存储。

## 技术依赖关系

- 前端（React）通过 REST API 调用后端（FastAPI）；鉴权采用 JWT。 
- 后端主数据库为 MySQL，配合 Redis 做缓存与 Celery Broker。 
- 媒体文件在开发阶段放本地 `uploads/`，生产使用 S3/MinIO；文件路径保存在数据库中。 
- RAG 流程（第二阶段）：文档先向量化并存入向量库（Milvus/Weaviate），查询端先检索相关文档片段，再送入生成模型。 

## 潜在风险与替代方案

| 技术选择 | 潜在风险 | 替代技术 | 替代理由 |
|---|---|---|---|
| `FastAPI` | 团队对类型与异步模型不熟悉可能有学习成本 | `Flask`（熟悉但功能较少） | 团队若对 Flask 更熟，可临时用 Flask；长期推荐 FastAPI。 |
| `MySQL` + LIKE/FTS | 随着数据增长，检索效果/性能下降 | 引入 Milvus/Weaviate + 向量检索 | 当 RAG 需求来临或检索效果不足时迁移。 |
| 使用外部 LLM API | 成本与隐私问题（用户数据） | 部署本地小模型或使用私有云模型 | 若预算或隐私受限，优先用检索+模板回答，或使用本地开源模型。 |
| 本地文件存储 | 不利于横向扩展与备份 | `S3` / `MinIO` | 生产环境应尽早切换至可扩展的对象存储。 |

## 完成后

1. 文档保存路径：`docs/2025-12-27-孤独症关怀智能体平台-技术栈设计.md`。
2. 核心选型概述：
   - 后端优先使用 `FastAPI`（开发效率高、自动文档）；数据库用 `MySQL`；前端使用 `React` + `Ant Design` 做管理后台；检索阶段先用 `SQLite FTS`/MySQL Fulltext 做 MVP，第二阶段引入 `Milvus/Weaviate` 做向量检索并结合生成模型实现 RAG。 
   - 使用 `Redis` + `Celery` 做异步任务与缓存，媒体开发阶段放本地、生产使用 `S3/MinIO`。部署以 `Docker` + `docker-compose` 为起点，配合 `GitHub Actions` 做 CI/CD。 
3. 提醒：请确认团队对 `FastAPI` 与 `React` 的接受度并评估是否需要基础培训（1-2 次入门会话），以及是否已有云/对象存储预算以便早期决定存储策略。 
4. 是否需要我继续：
   - 将第一阶段拆分为 Issue/迭代任务清单（Jira/GitHub Issues 样式）；
   - 为 `FastAPI` 生成初步的路由与 Pydantic 模型草案；
   - 创建 `docker-compose` 示例与 `requirements.txt`/`pyproject.toml`；
   - 帮你把文件提交到 git（创建分支并提交）。

文档编写者：架构师 AI 助手（依据 `0-prompts/commands/项目设计/2-design_tech_stack.md` 指南）
