# 数据库类型调研 研究报告

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-15 | v1.0 | 初始调研报告 | 无 |

## 研究问题

目前后端项目实际使用的数据库类型是什么？

## 发现摘要

- 项目默认配置使用 SQLite 数据库，数据库文件为 `./dev.db`，通过 SQLAlchemy 进行 ORM 操作。
- 数据库连接 URL 由 `app/core/config.py` 中的 `DB_URL` 字段控制，支持通过环境变量覆盖。
- 数据库引擎初始化与会话管理在 `app/db/session.py` 中实现。
- 项目结构支持更换为其他数据库（如 PostgreSQL、MySQL），只需调整 `DB_URL` 配置。

## 相关文件清单

|文件路径|作用说明|关键行号|
|---|---|---|
|app/core/config.py|数据库连接配置，默认 SQLite|L4-L21|
|app/db/session.py|SQLAlchemy 引擎与会话管理|L1-L20|
|pyproject.toml|依赖声明（SQLAlchemy）|L16|
|requirements.txt|依赖声明（SQLAlchemy）|L6|

## 当前实现分析

- 数据库连接配置在 `app/core/config.py` 的 `Settings` 类中，默认值为：
  ```python
  DB_URL: str = "sqlite:///./dev.db"
  ```
- 数据库引擎在 `app/db/session.py` 通过如下方式初始化：
  ```python
  engine = create_engine(settings.DB_URL, future=True)
  ```
- 会话管理使用 `sessionmaker`，并通过 `get_db()` 提供依赖注入。
- 支持通过 `.env` 文件或环境变量覆盖默认数据库 URL。

### 核心流程

```
[配置加载] --> [Settings.DB_URL] --(传递)--> [create_engine] --> [SessionLocal/session]
```

### 关键代码片段

- `app/core/config.py`：
  ```python
  class Settings(BaseSettings):
      DB_URL: str = "sqlite:///./dev.db"
      ...
  settings = Settings()
  ```
- `app/db/session.py`：
  ```python
  engine = create_engine(settings.DB_URL, future=True)
  SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
  ```

## 架构洞察

- 采用 SQLAlchemy 作为 ORM，具备良好的数据库可移植性。
- 通过配置项灵活切换数据库类型，适合开发/生产环境分离。

## 潜在风险和边缘情况

- 默认 SQLite 仅适合开发/测试，生产环境需更换为更强健的数据库（如 PostgreSQL）。
- 若未正确配置环境变量，可能误用开发数据库。

## 开放问题

- 生产环境实际部署时，推荐的数据库类型与配置方式？
- 是否有数据库迁移/初始化脚本的标准流程？

## 参考资料

- [SQLAlchemy 官方文档](https://docs.sqlalchemy.org/)
- 项目 `README.md`、`pyproject.toml`、`requirements.txt`
