# 知识库的搭建 实现计划

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-17 | v1.0 | 初始计划 | 基于研究报告制定实现方案 |

## 关联研究
[docs/tasks/谢君韬/00-知识库的搭建/2026-01-17_知识库的搭建_研究报告.md](docs/tasks/谢君韬/00-知识库的搭建/2026-01-17_知识库的搭建_研究报告.md)

## 功能概述

参照用户管理系统的分层与风格，搭建支持元数据管理、内容查阅、审核流的知识库模块，并为后续向量化检索预留接口。支持混合审核模式，确保内容权威性与上线效率。

---

## Phase 1: 数据模型与Schema定义

### 目标
- 定义 KnowledgeItem、KnowledgeChunk ORM模型与Pydantic Schema，包含来源、引用、作者等元数据字段。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|app/models/knowledge.py|新增|知识条目与切片ORM模型|
|app/schemas/knowledge.py|新增|知识条目与切片Pydantic模型|

### 具体变更
- 参照研究报告关键代码片段，定义所有字段。

### 成功标准
- 自动验证：通过mypy、pydantic校验，无类型/语法错误。
- 手动验证：可在Python shell中导入并实例化模型。

---

## Phase 2: Service与审核流实现

### 目标
- 实现知识条目CRUD、审核流（含混合审核模式）、状态流转逻辑。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|app/services/knowledge_service.py|新增|知识库业务逻辑，含混合审核实现|

### 具体变更
- 支持志愿者/专家提交、专家审核、复核、驳回、编辑、发布等操作。
- 审核流可配置单级/多级，支持审核历史记录。

### 成功标准
- 自动验证：pytest覆盖主要业务分支。
- 手动验证：通过Service层API模拟多种审核流转场景。

---

## Phase 3: API路由与权限控制

### 目标
- 提供RESTful接口，严格区分角色权限，支持查阅、提交、审核、复核等操作。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|app/api/v1/routes/knowledge.py|新增|知识库相关API路由|
|app/api/v1/deps.py|更新|增加知识库相关依赖与权限校验|

### 具体变更
- 参照用户API风格，设计接口（如POST/GET/PUT /knowledge/items, /knowledge/audit-list等）。
- 权限依赖确保只有专家可审核，混合审核模式下支持多级审核。

### 成功标准
- 自动验证：接口单元测试、权限测试通过。
- 手动验证：用Postman等工具全流程走通。

---

## Phase 4: 向量化接口预留

### 目标
- 预留向量化相关接口/模块，便于后续无缝接入。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|app/knowledge/rag_pipeline.py|更新/新增|定义vectorize_knowledge_item等接口，抛出NotImplementedError|
|app/knowledge/vectorstore/|新增|向量化相关目录与空实现|

### 具体变更
- 仅定义接口与调用点，详细参数/返回值待后续补充。

### 成功标准
- 自动验证：import无报错，调用时报NotImplementedError。
- 手动验证：开发文档/注释说明接口待实现。

---

## Phase 5: 前端与混合审核流对接

### 目标
- 前端可展示审核进度、历史意见，支持多级审核流转。

### 修改文件清单
|文件路径|修改类型|说明|
|---|---|---|
|（前端相关，需与前端协作）|对接/适配|审核流进度、历史、操作入口|

### 具体变更
- 提供API文档与接口示例，协助前端实现混合审核流展示。

### 成功标准
- 手动验证：前端可完整展示审核流转、进度与历史。

---

## PR模板建议

- feat(knowledge): 知识库模块分层搭建与混合审核流实现
- 说明：包含数据模型、Service、API、权限、向量化接口预留等，详见实现计划各Phase

---

## 版本记录

| 日期 | 版本 | 修改内容 | 修改原因 |
|---|---|---|---|
| 2026-01-17 | v1.0 | 初始计划 | 基于研究报告制定实现方案 |
