# 实现计划：将哈希算法从 bcrypt 迁移到 Argon2

## 1. 目标
将系统的密码哈希算法从 `bcrypt` 迁移到 `Argon2`，以解决 `bcrypt` 的 72 字节长度限制问题，并提升系统安全性。

## 2. 涉及文件
- `requirements.txt`
- `app/services/auth.py`

## 3. 实现步骤

### 3.1 添加依赖
在 `requirements.txt` 中添加 `argon2-cffi` 库。

### 3.2 修改 CryptContext 配置
修改 `app/services/auth.py` 文件，将 `pwd_context` 的 `schemes` 参数从 `["bcrypt"]` 改为 `["argon2"]`。

```python
# app/services/auth.py

# Before
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

# After
pwd_context = CryptContext(schemes=["argon2"], deprecated="auto")
```

### 3.3 验证
1.  **安装依赖**：运行 `pip install -r requirements.txt`。
2.  **启动服务**：启动后端服务。
3.  **注册测试**：尝试注册一个新用户，使用超过 72 字符的超长密码。
    *   预期结果：注册成功，不会报 500 错误。
4.  **登录测试**：使用刚才注册的用户进行登录。
    *   预期结果：登录成功。

## 4. 回滚计划
如果遇到严重问题：
1.  恢复 `app/services/auth.py` 中的配置为 `bcrypt`。
2.  注意：在 Argon2 配置生效期间注册的用户，回滚后将无法登录（因为系统不再识别 Argon2 哈希）。由于目前是开发阶段且无存量用户，此风险可接受。
